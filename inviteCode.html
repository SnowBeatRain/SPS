<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>邀请</title>
  <link rel="stylesheet" href="./css/inviteCode.css">
</head>

<body>
  <div class="container">
    <div class="inviter_code">
      <div class="code_title">
        邀请码
      </div>
      <div class="code_num">
        <span class="num"></span>
      </div>
    </div>
    <div class="qrCode">
      <div id="qrCode"></div>
      <img class="logoQr" src="./images/logo.png" alt="">
    </div>
    <div class="footer">
      <p>识别二维码完成注册
        <br>下载APP免费停车</p>
    </div>
  </div>
</body>
<script src="js/jquery-1.11.0.min.js" type="text/javascript"></script>
<script src="./js/fontsize.js"></script>
<script type="text/javascript" src="./js/jquery.qrcode.min.js"></script>
<!-- // 生成带logo二维码需要引入的js -->
<!-- <script type="text/javascript" src="./js/utf.js"></script> -->
<!-- <script src="./js/qrcode_logo.js"></script> -->
<script>
  var mainurl = "http://spsapp.spsing.com";
  // var token = window.location.href.split("token=")[1]
  var token =
    "74DC1C5F8BFDE976A29FD338FFB7FB7BBA3B2F65C332105B06CDFE592FF3058F60AAD400CF72D55C81A0F10ACC0750752994414052B33258E3DF2D8E0C883738"
  getInfo()

  function getInfo() {
    $.ajax({
      type: 'get',
      url: mainurl + '/api/Activity/GetUserInviteCode?token=' + token,
      success: function (data) {
        if (data.Status == 1) {
          $(".num").text(data.Result)
            jQuery('#qrCode').qrcode({
              render: "canvas", //设置渲染方式，有table和canvas，使用canvas方式渲染性能相对来说比较好
              text: "http://spsapp.spsing.com/content/activity/cmbc/inviteRegister.html?code=" + data.Result, //扫描二维码后显示的内容,可以直接填一个网址，扫描二维码后自动跳向该链接
              width: "200", //二维码的宽度
              height: "200", //二维码的高度
              background: "#ffffff", //二维码的后景色
              foreground: "#FFA922", //二维码的前景色
              src: 'images/logo.png' //二维码中间的图片
            });
          // //从 canvas 提取图片 image
          function convertCanvasToImage(canvas) {
            //新Image对象，可以理解为DOM
            var image = new Image();
            // canvas.toDataURL 返回的是一串Base64编码的URL，当然,浏览器自己肯定支持
            // 指定格式 PNG
            image.src = canvas.toDataURL("image/png");
            return image;
          }
          //获取网页中的canvas对象
          var mycanvas1 = document.getElementsByTagName('canvas')[0];
          //将转换后的img标签插入到html中
          var img = convertCanvasToImage(mycanvas1);
          $('#qrCode').html(img); //imagQrDiv表示你要插入的容器id
        } else {
          alert(data.Result)
        }
      },
      error: function () {
        alert("错误：请刷新重试")
      }
    });
  };
</script>

</html>