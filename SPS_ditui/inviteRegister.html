<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>立即注册</title>
  <link rel="stylesheet" href="./css/inviteRegister.css">
</head>

<body>
  <div class="container">
    <div class="btn_box">
      <!-- <div class="btn_info">
        <img onclick="showMask()" src="./img/rule_btn.png" alt="">
      </div> -->
      <div class="btn_msg">
        <p>邀请好友 完成注册</p>
      </div>
    </div>
    <div class="form_box">
      <div>
        <input type="number" class="phone" placeholder="请输入手机号">
      </div>
      <div>
        <input type="text" class="code" placeholder="验证码">
        <span class="get_code" id="btn" onclick="getYZ()">获取验证码</span>
      </div>
      <div>
        <input type="text" class="inviteCode" placeholder="请输入邀请码" disabled>
      </div>
      <div>
        <button class="sub_btn submit_on" onclick="subBtn()">立即注册</button>
        <button class="submit_off sub_btn" style="background-color:#a3a3a3;display: none; ">立即注册</button>
      </div>
    </div>
  </div>
</body>
<script src="js/jquery-1.11.0.min.js" type="text/javascript"></script>
<script src="./js/fontsize.js"></script>
<script src="./js/downApp.js"></script>
<script>
  var mainurl = "http://spsapp.spsing.com",
    // var mainurl = "http://192.168.1.112/SPS",

    syscouponid = "",
    islow = false; //是否是安卓低版本   不是

  // var ExtensionCode = window.location.href.split("code=")[1]
  var ExtensionCode = "83542261"
  $(".inviteCode").val(ExtensionCode)
  if (navigator.userAgent.indexOf('Android') > 0) {
    var phoneNum = navigator.userAgent.split('Android ')[1]
    if (phoneNum.split('.')[0] <= 4) {
      islow = true
    } else {
      islow = false
    }
  }
  // 获取验证码
  function getYZ() {
    var phone = $(".phone").val();
    if (phone == "") {
      alert("请输入手机号");
    } else if (!/^1\d{10}$/.test(phone)) {
      alert("请检查手机号");
    } else {
      var countdown = 60;

      function invokeSettime(obj) {
        settime(obj);

        function settime(obj) {
          if (countdown == 0) {
            $(obj).attr("disabled", false);
            $(obj).html("获取验证码");
            $(obj).css({
              'background-color': '#ffa922;'
            })
            countdown = 60;
            return;
          } else {
            $(obj).attr("disabled", true);
            $(obj).html("(" + countdown + ") 秒再获取");
            $(obj).css({
              'background-color': '#a3a3a3'
            })
            countdown--;
          }
          setTimeout(function () {
            settime(obj);
          }, 1000);
        }
        // 获取验证嘛
        $.ajax({
          type: "get",
          url: mainurl + "/api/VerifyCode/Send?phone=" + phone,
          success: function (data) {
            if (data.Status == 1) {
              alert(data.Result);
            } else {
              alert(data.Result);
            }
          }
        });
      }
      new invokeSettime("#btn");
    }
  }

  // 活动规则
  function showMask() {
    $('body').css("overflow", "hidden")
    $(".layer").fadeIn();
    $(".rule_box").fadeIn()
  };
  // 注册  弹框 
  function subBtn() {
    var phone = $(".phone").val().trim();
    var yz = $(".code").val().trim();
    var code = $(".inviteCode").val().trim();
    if (phone == "" || yz == "" || code == "") {
      alert("请完善信息")
    } else {
      $.ajax({
        type: "post",
        url: mainurl + "/api/Activity/InvitationRregister",
        datatype: "json",
        data: {
          "Phone": phone,
          "Code": yz,
          "ExtensionCode": code
        },
        success: function (data) {
          if (data.Status == 1) {
            $('body').css("overflow", "hidden")
            $(".layer").fadeIn();
            $(".success_box").fadeIn()
            $(".submit_on").hide()
            $(".submit_off").show()
          } else {
            alert(data.Result);
          }
        }
      });
    }
  };
  // 点击关闭
  function closeRule() {
    $('body').css("overflow", "visible")
    $(".layer").fadeOut();
    $(".tipMsg").fadeOut()
  }
</script>

</html>