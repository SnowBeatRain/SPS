<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>立即注册</title>
  <link rel="stylesheet" href="./css/inviteRegister.css">
</head>

<body>
  <div class="container">
    <div class="btn_box">
      <div class="btn_info">
        <img onclick="showMask()" src="./images/rule_btn.png" alt="">
      </div>
      <div class="btn_msg">
        <p>邀请好友 享免费停车</p>
        <p>完成注册 领停车礼包</p>
      </div>
      <a href="javascript:startApp();">
        <button id="openapp">下载APP</button>
      </a>
    </div>
    <div class="form_box">
      <div>
        <input type="number" class="phone" placeholder="请输入手机号">
      </div>
      <div>
        <input type="text" class="code" placeholder="验证码">
        <span class="get_code" id="btn" onclick="getYZ()">获取验证码</span>
      </div>
      <div>
        <input type="text" class="inviteCode" placeholder="请输入邀请码" disabled>
      </div>
      <div>
        <button class="sub_btn submit_on" onclick="subBtn()">立即注册</button>
        <button class="submit_off sub_btn" style="background-color:#a3a3a3;display: none; ">立即注册</button>
      </div>
    </div>
    <div class="layer"></div>
    <!-- 活动规则弹框 -->
    <div class="tipMsg rule_box">
      <p class="close_btn close">
        <img onclick="closeRule()" src="./images/close_2.png" alt="">
      </p>
      <div class="ruleList">
        <h3>活动规则</h3>
        <p>1、被邀请人限定范围：必须是SPS停车新用户（SPS停车新用户的定义：SPS停车新注册用户或历史未使用SPS停车登录注册过的用户）</p>
        <p>2、用户可通过分享邀请码来邀请好友。该好友在分享的邀请页面上完成首次SPS账号注册后，即视为邀请成功。</p>
        <p>3、邀请人在成功邀请好友后，系统会自动发放代金券到邀请人的账户上，如果邀请人的账户中存在成功支付并完成的无感支付订单，则系统发放的代金券自动升级成此前最后一笔订单梯度内上限的代金券（使用有效期为发放日至此后30天）。反之如果邀请人账户中不存在无感支付订单，则系统自动发放5元代金券（使用有效期为发放日至此后15天）。</p>
        <p>4、活动代金券可在下一笔APP内订单中自动抵扣，不可累加、找零、折现，不可与其他优惠活动同时享受。</p>
        <p>5、被邀请人成功完成首次注册后，系统会自发放新人大礼包到被邀请人的账户上（大礼包使用有效期为发放日至此后30天）。</p>
        <p>6、用户可无限次地邀请好友，用户每次重新进入活动页面时可获得不同的邀请码，一个邀请码只能成功邀请一个好友。</p>
        <p>7、同一SPS账号、手机号、手机终端，符合以上任一条件的，均视为同一账户。</p>
        <p>8、如用户出现违规行为（如虚假交易、作弊等），SPS将撤销用户的参与资格。</p>
      </div>
    </div>
    <div class="tipMsg success_box">
      <p class="close_btn close">
        <img onclick="closeRule()" src="./images/close_2.png" alt="">
      </p>
      <div class="successMsg">
        <h3>注册完成</h3>
        <p>恭喜您获得信任注册礼包，快去看看吧</p>
        <div>
          <a href="javascript:startApp();">
            <button class="sub_btn">下载APP免费停车</button>
          </a>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="js/jquery-1.11.0.min.js" type="text/javascript"></script>
<script src="./js/fontsize.js"></script>
<script src="./js/downApp.js"></script>
<script>
  var mainurl = "http://spsapp.spsing.com",
    // var mainurl = "http://192.168.1.112/SPS",

    syscouponid = "",
    islow = false; //是否是安卓低版本   不是

  // var ExtensionCode = window.location.href.split("code=")[1]
  var ExtensionCode = "83542261"
  $(".inviteCode").val(ExtensionCode)
  if (navigator.userAgent.indexOf('Android') > 0) {
    var phoneNum = navigator.userAgent.split('Android ')[1]
    if (phoneNum.split('.')[0] <= 4) {
      islow = true
    } else {
      islow = false
    }
  }
  // 获取验证码
  function getYZ() {
    var phone = $(".phone").val();
    if (phone == "") {
      alert("请输入手机号");
    } else if (!/^1\d{10}$/.test(phone)) {
      alert("请检查手机号");
    } else {
      var countdown = 60;

      function invokeSettime(obj) {
        settime(obj);

        function settime(obj) {
          if (countdown == 0) {
            $(obj).attr("disabled", false);
            $(obj).html("获取验证码");
            $(obj).css({
              'background-color': '#ffa922;'
            })
            countdown = 60;
            return;
          } else {
            $(obj).attr("disabled", true);
            $(obj).html("(" + countdown + ") 秒再获取");
            $(obj).css({
              'background-color': '#a3a3a3'
            })
            countdown--;
          }
          setTimeout(function () {
            settime(obj);
          }, 1000);
        }
        // 获取验证嘛
        $.ajax({
          type: "get",
          url: mainurl + "/api/VerifyCode/Send?phone=" + phone,
          success: function (data) {
            if (data.Status == 1) {
              alert(data.Result);
            } else {
              alert(data.Result);
            }
          }
        });
      }
      new invokeSettime("#btn");
    }
  }

  // 活动规则
  function showMask() {
    $('body').css("overflow", "hidden")
    $(".layer").fadeIn();
    $(".rule_box").fadeIn()
  };
  // 注册  弹框 
  function subBtn() {
    var phone = $(".phone").val().trim();
    var yz = $(".code").val().trim();
    var code = $(".inviteCode").val().trim();
    if (phone == "" || yz == "" || code == "") {
      alert("请完善信息")
    } else {
      $.ajax({
        type: "post",
        url: mainurl + "/api/Activity/InvitationRregister",
        datatype: "json",
        data: {
          "Phone": phone,
          "Code": yz,
          "ExtensionCode": code
        },
        success: function (data) {
          if (data.Status == 1) {
            $('body').css("overflow", "hidden")
            $(".layer").fadeIn();
            $(".success_box").fadeIn()
            $(".submit_on").hide()
            $(".submit_off").show()
          } else {
            alert(data.Result);
          }
        }
      });
    }
  };
  // 点击关闭
  function closeRule() {
    $('body').css("overflow", "visible")
    $(".layer").fadeOut();
    $(".tipMsg").fadeOut()
  }
</script>

</html>